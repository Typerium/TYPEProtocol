<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="ICO smart contract example">

    <title>Typerium Test ICO</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="bootstrap.min.css" />
    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="custom.css" />
  </head>
  <body>
    <div class="container">
      <div class="header clearfix">
        <nav>
          <ul class="nav nav-pills float-right">
            <li class="nav-item">
              <a class="nav-link active" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="api.html" target="_blank">Code &amp; Tutorial</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" target="_blank" href="https://ropsten.etherscan.io/address/0x81040d6aa0e642feea5e3ff420eb02b3781e66ff">Contract</a>
            </li>
          </ul>
        </nav>
        <h3 class="text-muted">Typerium Test Token ICO</h3>
      </div>

      <div class="jumbotron">
        <h1 class="display-5">Typerium ICO Contract Address</h1>
        <br>
        <p class="lead"><strong>0x384EB0e4416179047B82092B8741805935b2fEd8</strong></p>
        <p>Send ether to <a href="https://ropsten.etherscan.io/address/0x81040d6aa0e642feea5e3ff420eb02b3781e66ff" target="_blank">contract address</a> in order to buy <a href="https://ropsten.etherscan.io/token/0x6979a9c4e260f51a22e54b798d6a91d59fd13054" target="_blank">TYPE tokens</a> (minimum 0.0001 ETH)</p>
        <br>
        <h1 class="display-5">Total Raised</h1>
        <p class="lead"><strong id="raised">0</strong> ETH</p>
      </div>

      <div class="row marketing">
        <div class="col-lg-6">
          <h4>Price</h4>
          <p>1 ETH = <span id="rate">0</span> TYPE</p>

          <h4>Current Bonus</h4>
          <p><span id="bonus">0</span>%</p>

        </div>

        <div class="col-lg-6">
          <h4>Tokens Sold</h4>
          <p><span id="sold">0</span> TYPE</p>

          <h4>Tokens Available</h4>
          <p><span id="available">0</span> TYPE</p>

        </div>
      </div>

      <footer class="footer">
        <p>&copy; Typerium 2018</p>
      </footer>

    </div> <!-- /container -->
    <script language="javascript" type="text/javascript" src="web3.min.js"></script>
    <script language="javascript" type="text/javascript" src="config.js"></script>
    <script>
        //connect to web-socket to have a web3-provider
        var web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/M6z4fZW1F0INgQ5TGwGO"));
        //var web3 = new Web3(new Web3.providers.WebsocketProvider("wss://ropsten.infura.io/ws"));
        //address of crowdSale smart-contract
        var contractAddress = '0x81040d6aa0e642feea5e3ff420eb02b3781e66ff';
        //address of typeToken smart-contract
        var tokenAddress = '0x6979a9c4e260f51a22e54b798d6a91d59fd13054';
        //decimal configuration for ETH and TYPE tokens
        var tokenDecimals = 4;
        var etherDecimals = 18;
        //making contract instance to call available methods
        var contractInstance = new web3.eth.Contract(crowdSaleAbi, contractAddress);
        var tokenInstance = new web3.eth.Contract(tokenAbi, tokenAddress);

        //checking avaialable methods
        console.log(contractInstance.methods);
        console.log(tokenInstance.methods);

        //populating UI with values - let's go! sold tokens amount
        contractInstance.methods.soldTokens().call().then(function(amount) {
          document.getElementById('sold').innerHTML = amount / (10 ** tokenDecimals);
        });
        //current bonus value
        contractInstance.methods.bonus().call().then(function(value) {
          document.getElementById('bonus').innerHTML = value;
        });
        //current rate per 1 ETH
        contractInstance.methods.rate().call().then(function(value) {
          document.getElementById('rate').innerHTML = value;
        });
        //amount of ETH raised so far
        contractInstance.methods.weiRaised().call().then(function(amount) {
          document.getElementById('raised').innerHTML = amount / (10 ** etherDecimals);
        });
        //checking balance of contract in order to see how many tokens still available
        tokenInstance.methods.balanceOf(contractAddress).call().then(function(amount) {
          document.getElementById('available').innerHTML = amount / (10 ** tokenDecimals);
        });
    </script>
  </body>
</html>
